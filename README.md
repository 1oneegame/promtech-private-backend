# IntegrityOS Backend MVP

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –º–∞–≥–∏—Å—Ç—Ä–∞–ª—å–Ω—ã—Ö —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥–æ–≤.

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
terricon/
‚îú‚îÄ‚îÄ models.py           # Pydantic –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ parser.py           # CSV –ø–∞—Ä—Å–µ—Ä —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ database.py         # –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å MongoDB (+ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)
‚îú‚îÄ‚îÄ app.py              # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ importer.py         # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ format.py           # –û—á–∏—Å—Ç–∫–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CSV
‚îú‚îÄ‚îÄ requirements.txt    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ data/               # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å CSV-—Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ Svodny_Otchet_ILI_Clean.csv
‚îÇ   ‚îî‚îÄ‚îÄ CSV/
‚îî‚îÄ‚îÄ README.md
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ)
cd c:\Users\aizha\terricon
venv\Scripts\activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV

```bash
# –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏)
python importer.py

# –° MongoDB (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞)
python importer.py --mongodb
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ API

```bash
python app.py
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:8000**

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: **http://localhost:8000/docs**

## üìö API Endpoints

### Health & Info
- `GET /` - –°—Ç–∞—Ç—É—Å API
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `GET /info` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ

### Defects (–î–µ—Ñ–µ–∫—Ç—ã)
- `GET /defects` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- `GET /defects/{defect_id}` - –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ñ–µ–∫—Ç –ø–æ ID
- `GET /defects/severity/{severity}` - –î–µ—Ñ–µ–∫—Ç—ã –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
- `GET /defects/type/{defect_type}` - –î–µ—Ñ–µ–∫—Ç—ã –ø–æ —Ç–∏–ø—É
- `GET /defects/segment/{segment_id}` - –î–µ—Ñ–µ–∫—Ç—ã –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É

### Analytics (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞)
- `GET /statistics` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–µ—Ñ–µ–∫—Ç–∞–º

### Export (–≠–∫—Å–ø–æ—Ä—Ç)
- `GET /export/json` - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ JSON

### Admin
- `POST /reload` - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV
- `DELETE /clear` - –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–µ—Ñ–µ–∫—Ç—ã

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–µ—Ñ–µ–∫—Ç—ã

```bash
curl http://localhost:8000/defects
```

### –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ñ–µ–∫—Ç—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏

```bash
curl "http://localhost:8000/defects?severity=high"
```

### –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ñ–µ–∫—Ç—ã –ø–æ —Ç–∏–ø—É

```bash
curl "http://localhost:8000/defects?defect_type=–∫–æ—Ä—Ä–æ–∑–∏—è"
```

### –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ñ–µ–∫—Ç—ã –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É

```bash
curl "http://localhost:8000/defects?segment=3"
```

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```bash
curl http://localhost:8000/statistics
```

### –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ JSON

```bash
curl http://localhost:8000/export/json
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª–∏

#### Defect (–î–µ—Ñ–µ–∫—Ç)
```python
{
    "defect_id": "string",
    "segment_number": 3,
    "measurement_number": 7,
    "measurement_distance_m": 5.125,
    "defect_type": "–∫–æ—Ä—Ä–æ–∑–∏—è",           # –∫–æ—Ä—Ä–æ–∑–∏—è, —Å–≤–∞—Ä–Ω–æ–π —à–æ–≤, –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç
    "severity": "medium",                # normal, medium, high, critical
    "parameters": {
        "length_mm": 16.0,
        "width_mm": 15.0,
        "depth_mm": 6.0,
        "depth_percent": 0.54,
        "wall_thickness_nominal_mm": 7.9
    },
    "location": {
        "latitude": 48.477933,
        "longitude": 57.663105,
        "altitude": 264.9
    },
    "surface_location": "–í–ù–®",           # –í–ù–® (–≤–Ω–µ—à–Ω—è—è –Ω–∏–∂–Ω—è—è), –í–ù–¢ (–≤–Ω–µ—à–Ω—è—è –≤–µ—Ä—Ö–Ω—è—è)
    "distance_to_weld_m": -0.793,
    "erf_b31g_code": "SAFE",
    "pipeline_id": "MT-03",
    "inspection_date": "2024-01-01T00:00:00",
    "inspection_method": "MFL",
    "source_file": "Svodny_Otchet_ILI_Clean.csv",
    "created_at": "2024-12-06T10:00:00",
    "updated_at": "2024-12-06T10:00:00"
}
```

### –£—Ä–æ–≤–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ (Severity)

**Rule-based –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ ASME B31G:**

- **normal** (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ): –≥–ª—É–±–∏–Ω–∞ < 10%
- **medium** (—Å—Ä–µ–¥–Ω–µ–µ): –≥–ª—É–±–∏–Ω–∞ 10-30%
- **high** (–≤—ã—Å–æ–∫–æ–µ): –≥–ª—É–±–∏–Ω–∞ 30-80%
- **critical** (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ): –≥–ª—É–±–∏–Ω–∞ > 80%

## üóÑÔ∏è –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –ë–î

### –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ MongoDB
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è MVP –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```python
db_connection = MongoDBConnection(local_mode=True)
```

### MongoDB —Ä–µ–∂–∏–º
- –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ MongoDB
- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –¥–ª—è production
- –ó–∞–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `MONGODB_URI`

```python
db_connection = MongoDBConnection(local_mode=False, mongo_uri="mongodb://localhost:27017")
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª—ã:
- `parser.log` - –õ–æ–≥–∏ –ø–∞—Ä—Å–µ—Ä–∞ CSV
- `parse_errors.log` - –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
- `import.log` - –õ–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

## üîÑ Workflow

1. **–ü–∞—Ä—Å–∏–Ω–≥ CSV** (`parser.py`)
   - –ß–∏—Ç–∞–µ—Ç CSV-—Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `data/`
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
   - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –æ–±—ä–µ–∫—Ç—ã `Defect`
   - –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –ø–æ ASME B31G

2. **–•—Ä–∞–Ω–∏–ª–∏—â–µ** (`database.py`)
   - MongoDB –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
   - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –¥–µ—Ñ–µ–∫—Ç–∞–º–∏
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫

3. **API** (`app.py`)
   - FastAPI endpoints
   - JSON responses
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger/OpenAPI
   - CORS –ø–æ–¥–¥–µ—Ä–∂–∫–∞

## üõ†Ô∏è –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
```bash
python app.py
```

### –° Uvicorn (production)
```bash
uvicorn app:app --host 0.0.0.0 --port 8000 --workers 4
```

### –° Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
docker build -t integrityos-backend .
docker run -p 8000:8000 integrityos-backend
```

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- FastAPI
- Uvicorn
- Pydantic
- Pandas
- PyMongo (–¥–ª—è MongoDB —Ä–µ–∂–∏–º–∞)

## ‚úÖ –°–ø–∏—Å–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ CSV —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö –∫–æ–¥–∏—Ä–æ–≤–æ–∫
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤
- ‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –ø–æ ASME B31G
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ–µ –∏ MongoDB —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- ‚úÖ FastAPI REST API
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É, –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏, —Å–µ–≥–º–µ–Ω—Ç—É
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger

## üìå –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [ ] Frontend —Å Leaflet –∫–∞—Ä—Ç–æ–π
- [ ] –î–∞—à–±–æ—Ä–¥ —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏
- [ ] ML-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ (HTML/PDF)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω–æ–π MongoDB
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] Websocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–æ–±–ª–µ–º —Å–º–æ—Ç—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤:
- `parser.log`
- `parse_errors.log`
- `import.log`

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
